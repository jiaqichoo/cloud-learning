name: Deploy to AWS

on:
  workflow_dispatch:

env:
  AWS_REGION: ap-southeast-1

jobs:
  real-deployment:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Test AWS Connection
      run: |
        echo "ðŸ”— Testing AWS connection..."
        aws sts get-caller-identity
        echo "âœ… AWS connection successful!"

    - name: Create S3 Bucket
      run: |
        echo "ðŸš€ Creating S3 bucket..."
        
        # Generate unique bucket name
        TIMESTAMP=$(date +%s)
        BUCKET_NAME="github-actions-success-$TIMESTAMP"
        
        echo "ðŸ“¦ Creating: $BUCKET_NAME"
        
        # Create the bucket
        aws s3api create-bucket \
          --bucket $BUCKET_NAME \
          --region $AWS_REGION \
          --create-bucket-configuration LocationConstraint=$AWS_REGION
        
        echo "âœ… Bucket created successfully!"
        
        # Add tags
        aws s3api put-bucket-tagging \
          --bucket $BUCKET_NAME \
          --tagging 'TagSet=[{Key=Environment,Value=learning},{Key=Source,Value=GitHub-Actions},{Key=Project,Value=Automated-Deployment}]'

    - name: List All Buckets
      run: |
        echo "ðŸ“Š Your S3 buckets:"
        aws s3 ls

    - name: Major Celebration ðŸŽ‰
      run: |
        echo " "
        echo "ðŸŒˆðŸŒˆðŸŒˆ CONGRATULATIONS! ðŸŒˆðŸŒˆðŸŒˆ"
        echo " "
        echo "ðŸŽ¯ YOU'VE SUCCESSFULLY BUILT:"
        echo "âœ… Automated CI/CD Pipeline"
        echo "âœ… Infrastructure as Code"
        echo "âœ… AWS Cloud Deployment"
        echo "âœ… Professional DevOps Setup"
        echo " "
        echo "ðŸš€ THIS IS PRODUCTION-LEVEL AUTOMATION!"
        echo "ðŸ’¼ You now have valuable cloud engineering skills!"
        echo " "
        echo "Check AWS S3 Console to see your new bucket!"
