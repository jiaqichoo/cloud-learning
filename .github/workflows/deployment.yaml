name: Deploy to AWS

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  AWS_REGION: us-east-1

jobs:
  deploy-s3-bucket:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: List available templates
      run: |
        echo "ğŸ“ Available CloudFormation templates:"
        find . -name "*.yaml" -o -name "*.yml" | grep -v ".github" || echo "No templates found in root"

    - name: Create Simple S3 Bucket
      run: |
        echo "ğŸš€ Creating S3 bucket via AWS CLI..."
        
        # Create a unique bucket name
        TIMESTAMP=$(date +%s)
        BUCKET_NAME="github-actions-bucket-$TIMESTAMP"
        
        echo "ğŸ“¦ Creating bucket: $BUCKET_NAME"
        
        # Create bucket using AWS CLI
        aws s3api create-bucket \
          --bucket $BUCKET_NAME \
          --region $AWS_REGION \
          --create-bucket-configuration LocationConstraint=$AWS_REGION
        
        echo "âœ… Bucket created successfully: $BUCKET_NAME"
        
        # Tag the bucket
        aws s3api put-bucket-tagging \
          --bucket $BUCKET_NAME \
          --tagging 'TagSet=[{Key=Environment,Value=pilot-training},{Key=Source,Value=GitHub-Actions},{Key=Purpose,Value=learning}]'
        
        echo "ğŸ·ï¸  Tags added to bucket"

    - name: List S3 Buckets
      run: |
        echo "ğŸ“Š Listing S3 buckets:"
        aws s3 ls

    - name: Success Celebration
      run: |
        echo " "
        echo "ğŸ‰ ğŸ‰ ğŸ‰ SUCCESS! ğŸ‰ ğŸ‰ ğŸ‰"
        echo " "
        echo "ğŸš€ REAL AWS DEPLOYMENT COMPLETED!"
        echo "ğŸ“¦ S3 Bucket created via GitHub Actions"
        echo "ğŸ”§ Automated CI/CD pipeline is WORKING!"
        echo "ğŸ’¼ Professional DevOps skill ACQUIRED!"
        echo " "
        echo "Next: Check AWS Console to see your new bucket!"
