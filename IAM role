AWSTemplateFormatVersion: '2010-09-09'
Description: Template that needs IAM role

Resources:
  LearningBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub "learning-bucket-${AWS::AccountId}"

# This Lambda function WILL need IAM role
TestFunction:
  Type: AWS::Lambda::Function
  Properties:
    Runtime: python3.9
    Handler: index.lambda_handler
    Role: !GetAtt LambdaExecutionRole.Arn
    Code: 
      ZipFile: |
        def lambda_handler(event, context):
          return {"statusCode": 200, "body": "Hello World"}

# This IAM role WILL trigger the acknowledgment
LambdaExecutionRole:
  Type: AWS::IAM::Role
  Properties:
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
        - Effect: Allows
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
